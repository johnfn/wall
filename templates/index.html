<html>
  <head>
    <style type="text/css">
      body {
        font-family: Pacifico, "Helvetica Neue", sans-serif;
        position: relative;
        left: 20px;
      }

      .rightalittle {
        position: relative;
        left: 40px;
      }

    </style>
  </head>
  <body>
    <h1>All posts!</h1>


    <p>
    {% if loggedin %}
      Hi, <b>{{ user.username }}</b>. <a href="/logout/">Log out.</a> 

      {% if user_info.is_special %}
        <a href="/candidates/{{ user.username }}">Edit campaign information.</a>
      {% endif %}


    {% else %}
      {# Display login form #}
      <br> You're not logged in. 

      <a href="newaccount/">Create an account! </a> </br>

      <form action="/login/" method = "post">
        {% csrf_token %}
        <br>
          Username: <input type="text" name="username" />
          Password: <input type="password" name="password" />
          <input type="submit" value="Log in!" />
        <br/>
      </form>

    {% endif %}
    </p>

    {% for post in posts %}
      {# Show every top level post #}

      {% if post.creators.is_special %}
        <b>
          <br>
            {% if post.challenge %}
              <a href="/candidates/{{ post.challenged_user }}/">@{{ post.challenged_user }}</a>
            {% endif %}

            {{ post.content }} 
          <br/> 
          <br> 
            <i>posted by</i> <a href="/candidates/{{post.creator}}/">{{ post.creator }}</a>. 
          </br>
        </b>
      {% else %}
        <br> 
          {% if post.challenge %}
            <a href="/candidates/{{ post.challenged_user }}/">@{{ post.challenged_user }}</a>
          {% endif %}

          {{ post.content }} 
        <br/> 
        <br>
          <i>posted by</i> {{ post.creator }}.
        </br>
      {% endif %}

      <div class="rightalittle">
        {# Show every comment to the post, and nudge it to the right #}
        {# a little. #}

        {% for comment in post.comment_set.all %}

          {% if comment.creators.is_special %}
            <b>
          {% endif %}

            <br> {{ comment.content }}</br> <br> <i>posted by</i> {{ comment.creator }}.</br>
          
          {% if comment.creators.is_special %}
            </b>
          {% endif %}

        {% endfor %}
      </div>
        <form action="/comment/{{ post.id }}" method = "post">
          {% csrf_token %}
          <br>Comment: </br>
          <br>
            <textarea name="content" cols="60%" rows="5" tabindex="4"></textarea>
          </br>
          <br>
            Will be posted by: 
            {% if loggedin %}
              <b> {{ user.username }}</b>.
              <input type="hidden" name="name" value="{{ user.username }}" />
            {% else %}
              <input type="text" name="name" />
            {% endif %}
            <input type="submit" value="Post!" />

          <br/>
        </form>

    {% endfor %}


    <form action="/newpost/" method = "post">
      {% csrf_token %}
      Post: <br/>
      <textarea name="content" cols="60%" rows="10" tabindex="4"></textarea><br/>
      <br>
        Will be posted by: 
        {% if loggedin %}
          <b> {{ user.username }}</b>.
          <input type="hidden" name="name" value="{{ user.username }}" />
        {% else %}
          <input type="text" name="name" />
        {% endif %}
        <input type="submit" name="comment" value="Post!" />
        <input type="submit" name="challenge" value="Challenge!" />

        <!-- TODO: Programmatically generated -->
        <select name="challenged_user">
          <option value="special">special</option>
        </select>

      <br/>

    </form>
  </body>
</html>